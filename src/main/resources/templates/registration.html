<!-- layout/main.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header :: head}"></head>
<body class="d-flex flex-column min-vh-100" > <!-- Flexbox for full height -->
<header th:replace="~{layout/navbar :: header}"></header>
<main class="container mt-4 flex-grow-1">
    <!-- all content will be placed here -->

    <div class="row justify-content-center">
        <!-- Success message -->
        <div class="text-success text-center mb-4" th:if="${successMessage}">
            <h4 th:text="${successMessage}"></h4>
        </div>

        <!-- Registration Form -->
        <div class="col-md-6">
            <h3 class="alert alert-warning text-warning text-center mb-3 mt-5">Register an User Account</h3>
            <form th:action="@{/register}" th:object="${user}" method="post">

                <!-- Show error message -->
                <div class="alert alert-warning mb-4" th:if="${error}">
                    <h6 th:text="${error}"></h6>
                </div>

                <!-- Show validation error -->
                <div class="alert alert-danger" th:if="${#fields.hasErrors('*')}">
                    <h5 class="mb-4 text-center">Validation Error</h5>
                    <ul>
                        <li th:each="err : ${#fields.errors('*')}" th:text="${err}"></li>
                    </ul>
                </div>

                <!-- Name -->
                <div class="mb-3">
                    <label for="name" class="form-label">Name</label>
                    <input type="text" th:field="*{name}" class="form-control" id="name" name="name"
                           placeholder="Enter full name" required>
                    <div th:if="${#fields.hasErrors('name')}" th:errors="*{name}" class="text-danger"></div>
                </div>

                <!-- Email -->
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" th:field="*{email}" class="form-control" id="email" name="email"
                           placeholder="Enter email" required>
                    <div th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="text-danger"></div>
                </div>

                <!-- Password -->
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" th:field="*{password}" class="form-control" name="password" id="password"
                           placeholder="Enter password" required>
                    <div th:if="${#fields.hasErrors('password')}" th:errors="*{password}" class="text-danger"></div>
                </div>

                <!-- Phone Number -->
                <div class="mb-3">
                    <label for="phoneNumber" class="form-label">Phone Number</label>
                    <input type="text" th:field="*{phoneNumber}" class="form-control" id="phoneNumber" name="phoneNumber"
                           placeholder="Enter phone number" required>
                    <div th:if="${#fields.hasErrors('phoneNumber')}" th:errors="*{phoneNumber}" class="text-danger"></div>
                </div>

                <!-- Address Section -->
                <div id="addressContainer">
                    <!-- Render empty address fields for the first address -->
                    <div class="address-section">
                        <h5>Address #1</h5>

                        <!-- Address Line 1 -->
                        <div class="mb-3">
                            <label for="addressLine1" class="form-label">Address Line 1</label>
                            <input type="text" th:field="*{addresses[0].addressLine1}" class="form-control"
                                   id="addressLine1" name="addresses[0].addressLine1" placeholder="Enter address line 1" required>
                            <div th:if="${#fields.hasErrors('addresses[0].addressLine1')}"
                                 th:errors="*{addresses[0].addressLine1}" class="text-danger"></div>
                        </div>

                        <!-- Address Line 2 -->
                        <div class="mb-3">
                            <label for="addressLine2" class="form-label">Address Line 2</label>
                            <input type="text" th:field="*{addresses[0].addressLine2}" class="form-control"
                                   id="addressLine2" name="addresses[0].addressLine2" placeholder="Enter address line 2">
                        </div>

                        <!-- City -->
                        <div class="mb-3">
                            <label for="city" class="form-label">City</label>
                            <input type="text" th:field="*{addresses[0].city}" class="form-control"
                                   id="city" name="addresses[0].city" placeholder="Enter city" required>
                        </div>

                        <!-- State -->
                        <div class="mb-3">
                            <label for="state" class="form-label">State</label>
                            <input type="text" th:field="*{addresses[0].state}" class="form-control"
                                   id="state" name="addresses[0].state" placeholder="Enter state" required>
                        </div>

                        <!-- Zip Code -->
                        <div class="mb-3">
                            <label for="zipCode" class="form-label">Zip Code</label>
                            <input type="text" th:field="*{addresses[0].zipCode}" class="form-control"
                                   id="zipCode" name="addresses[0].zipCode" placeholder="Enter zip code" required>
                        </div>

                        <!-- Country -->
                        <div class="mb-3">
                            <label for="country" class="form-label">Country</label>
                            <input type="text" th:field="*{addresses[0].country}" class="form-control"
                                   id="country" name="addresses[0].country" placeholder="Enter country" required>
                        </div>

                        <!-- Set as Default Address -->
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" th:field="*{addresses[0].isDefault}" id="isDefault">
                            <label class="form-check-label" for="isDefault">
                                Set as default address
                            </label>
                        </div>
                    </div>
                </div>



                <!-- Submit Button -->
                <button type="submit" class="btn btn-primary w-100">Register</button>

                <!-- Error Message -->
                <div class="text-danger" th:if="${error}">
                    <p th:text="${error}"></p>
                </div>

            </form>
        </div>
    </div>
</main>
<footer th:replace="~{layout/footer :: footer}"></footer>
</body>
</html>
