<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/header :: head}"></head>
<body class="d-flex flex-column min-vh-100">
<header th:replace="~{layout/navbar :: header}"></header>
<main class="container mt-4 flex-grow-1">
  <h2>Your Shopping Cart</h2>
  <div th:if="${cartItems.isEmpty()}" class="alert alert-warning">
    Your cart is empty. <a href="/products">Continue shopping</a>
  </div>
  <div class="container mt-3">
    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${errorMessage}"></div>
  </div>

  <div th:if="${!cartItems.isEmpty()}">
    <table class="table">
      <thead>
      <tr>
        <th>Product</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Total</th>
        <th>Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="item : ${cartItems}">
        <td th:text="${item.product.name}"></td>
        <td>৳ <span th:text="${item.product.price}"></span></td>
        <td th:text="${item.quantity}"></td>
        <td>৳ <span th:text="${item.product.price.multiply(new java.math.BigDecimal(item.quantity))}"></span></td>
        <td>
          <a th:href="@{/cart/remove/{id}(id=${item.id})}" class="btn btn-danger btn-sm">Remove</a>
        </td>
      </tr>
      </tbody>
    </table>
    <div class="text-end">
      <h4>Total: ৳ <span th:text="${cartItems.stream().map(item -> item.product.price.multiply(new java.math.BigDecimal(item.quantity))).reduce(java.math.BigDecimal.ZERO, java.math.BigDecimal::add)}"></span></h4>
      <a href="/checkout" class="btn btn-primary">Checkout</a>
    </div>
  </div>
</main>
<footer th:replace="~{layout/footer :: footer}"></footer>
</body>
</html>
